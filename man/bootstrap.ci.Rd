% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bootstrap.ci.R
\name{bootstrap.ci}
\alias{bootstrap.ci}
\title{Bootstrap Confidence Intervals}
\usage{
bootstrap.ci(
  x,
  fun,
  R = 1000,
  conf = 0.95,
  type = c("norm", "basic", "stud", "perc", "bca"),
  parallel = c("no", "multicore", "snow"),
  ncpus = getOption("boot.ncpus", 1L),
  cl = NULL,
  ...
)
}
\arguments{
\item{x}{A numeric or factor vector of observations.}

\item{fun}{A function to summarize the observations.}

\item{R}{Integer specifying the number of permutations. Default is 1000.}

\item{conf}{Confidence level of the interval. Default is 0.95.}

\item{type}{A vector of character strings representing the type of intervals
required. The value should be any subset of the values \code{c("norm",
"basic", "stud", "perc", "bca")} or simply \code{"all"} which will compute
all five types of intervals.}

\item{parallel}{
    The type of parallel operation to be used (if any).  If missing, the
    default is taken from the option \code{"boot.parallel"} (and if that
    is not set, \code{"no"}).
  }

\item{ncpus}{
    integer: number of processes to be used in parallel operation:
    typically one would chose this to the number of available CPUs.
  }

\item{cl}{
    An optional \pkg{parallel} or \pkg{snow} cluster for use if
    \code{parallel = "snow"}.  If not supplied, a cluster on the
    local machine is created for the duration of the \code{boot} call.
  }

\item{...}{Additional arguments passed to \code{fun}.}
}
\value{
A a named list of confidence intervals, each containing lower and
  upper bounds, with additional attributes storing the observed statistic and
  the mean of the bootstrap replicates.
}
\description{
This function generates bootstrap resamples using \code{\link[boot]{boot}}
and computes confidence intervals using several standard bootstrap methods
via \code{\link[boot]{boot.ci}}. The indexing for the statistic function is
handled internally.
}
\details{
Supported interval types include normal approximation, basic, studentized
(bootstrap-t), percentile, and bias-corrected and accelerated (BCa)
intervals. If a requested interval type cannot be computed (for example,
studentized or BCa intervals), the function falls back to percentile
intervals.
}
\examples{
library(EvaluateCore)

pdata <- cassava_CC

qual <- c("CUAL", "LNGS", "PTLC", "DSTA", "LFRT", "LBTEF", "CBTR", "NMLB",
          "ANGB", "CUAL9M", "LVC9M", "TNPR9M", "PL9M", "STRP", "STRC",
          "PSTR")

# Conver '#t qualitative data columns to factor
pdata[, qual] <- lapply(pdata[, qual], as.factor)

str(pdata)

# Bootstrap CIs

bootstrap.ci(pdata$NMSR, mean, type = "norm")
bootstrap.ci(pdata$NMSR, mean, type = "basic")
bootstrap.ci(pdata$NMSR, mean, type = "perc")
bootstrap.ci(pdata$NMSR, mean, type = "bca")

bootstrap.ci(pdata$LNGS, shannon, type = "norm")
bootstrap.ci(pdata$PTLC, simpson, type = "basic")
bootstrap.ci(pdata$LFRT, mcintosh_evenness, type = "perc")
bootstrap.ci(pdata$LBTEF, mcintosh_diversity, type = "bca")

# Studentised intervals require a `fun` returning
# variances in addition to an estimate

bootstrap.ci(pdata$NMSR, mean, type = "stud")

stat_fun_mean <- function(x) {
  est <- mean(x)
  se  <- sd(x) / sqrt(length(x))
  c(est, se)
}

bootstrap.ci(pdata$NMSR, stat_fun_mean, type = "stud")

bootstrap.ci(pdata$DSTA, shannon, type = "stud")

stat_fun_shannon <- function(x, base = 2) {
  x <- droplevels(x)          # drop unused factor levels
  p <- prop.table(table(x))
  # Only keep p > 0 to avoid log(0)
  p <- p[p > 0]
  est <- -sum(p * log(p, base = base))
  # Approximate SE using sqrt(Var(p * log(p)))
  se <- sqrt(sum((p * log(p, base = base))^2) / length(x))
  c(est, se)
}

bootstrap.ci(pdata$DSTA, stat_fun_shannon, type = "stud")

}
